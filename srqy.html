<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
	<link href="/vitalets-bootstrap-datepicker/css/datepicker.css" rel="stylesheet" />
	<link href="/pure-release-1.0.0/pure-min.css" rel="stylesheet" />
	
	<link href="/bootstrap-select-1.13.2/css/bootstrap-select.min.css" rel="stylesheet" />

	
	<link href="/bootstrap3-editable-1.5.1/bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />
	<link href="/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />



	<script src="/js/jquery-3.3.1.min.js"></script>
	<script src="/bootstrap-3.3.7/js/bootstrap.min.js"></script> 
	<script src="/vitalets-bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script> 
    <script src="/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js" type="text/javascript"></script>
   
   	<script src="/bootstrap3-editable-1.5.1/bootstrap3-editable/js/bootstrap-editable.js"></script>
	<script src="/bootstrap-table/bootstrap-table.js"></script>
	<script src="/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
	<script src="/bootstrap-table/extensions/editable/bootstrap-table-editable.js"></script>
	
	<script src="/bootstrap-select-1.13.2/js/bootstrap-select.min.js"></script>
	<script src="/bootstrap-select-1.13.2/js/i18n/defaults-zh_CN.min.js"></script>
	
	
	<script src="/js/commonfun.js"></script>
	
   <title>Hello, world!</title>
   
  </head>
  
  <body>


<div style="padding: 20px 80px 10px;">
    
        <div class="row"> 
		<div class="span12">
			<div class="tabbable" id="tabs-974021">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="#panel-21660" data-toggle="tab">基本信息</a>
					</li>
					<li >
						<a href="#panel-86038" data-toggle="tab">储量</a>
					</li>
					<li >
						<a href="#panel-86039" data-toggle="tab">销售</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="panel-21660">
						<p>
							<div class="col-lg-3">
								<div  class="form-inline"> 
								 <label>评估日期:</label>
									<div class="input-group date" id="ws" >

										<input type="text" id="ww" class="form-control"  readonly>
										<span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i>
										</span>
									</div>
								</div>
								
								<p/>
								
								<div  class="form-inline"> 
								 <label>评估日期:</label>
									
										<div class="form-group">
											<select class="selectpicker" id="typeselect" data-width="240px">
												<option value="1">煤</option>
												<option value="2">金属</option>
												<option value="3">非金属</option>
												<option value="4">石材</option>
												                         
											</select>
										</div>
									
								</div>
								
								
								
								
								<p/>
								

								<div class="col-lg-14">
									<fieldset class="scheduler-border">
										<legend ><h5>五年生产规模</h5></legend>
										
										<div class=" input-group">
											<span class="input-group-addon">第一年：</span>
											<input type="text" class="form-control" id="scgm1" />
										</div>
										<p/>
										<div class=" input-group">
											<span class="input-group-addon">第二年：</span>
											<input type="text" class="form-control" id="scgm2"  />
										</div>
										<p/>
										
										<div class=" input-group">
											<span class="input-group-addon">第三年：</span>
											<input type="text" class="form-control" id="scgm3"  />
										</div>
										<p/>
										
										<div class=" input-group">
											<span class="input-group-addon">第四年：</span>
											<input type="text" class="form-control"  id="scgm4" />
										</div>
										<p/>
										
										<div class=" input-group">
											<span class="input-group-addon">第五年：</span>
											<input type="text" class="form-control"  id="scgm5" />
										</div>
										
										
									</fieldset>
								</div>
								
							</div>
				
						</p>
					</div>
					<div class="tab-pane " id="panel-86038">
						<p>
						<div class="container">
							<div id="toolbar">
								<button id="btncal" class="btn btn-sm btn-primary">
									<i class="glyphicon glyphicon-send"></i> 计算
								</button>
								
								<button id="btnadd" class="btn  btn-sm btn-success">
									<i class="glyphicon glyphicon-plus"></i> 添加
								</button>
								
								<button id="btndel" class="btn btn-sm btn-warning">
									<i class="glyphicon glyphicon-minus"></i> 删除
								</button>
							</div>

							<table id="table" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<th data-field="fc">1</th>
										<th data-field="sc">2</th>
										<th data-field="gcl">3</th>
										<th data-field="dwys">4</th>
										<th data-field="tzxs">5</th>
									</tr>
								</thead>
							</table>

						</div>
						</p>
					</div>
					
					<div class="tab-pane " id="panel-86039">
						<p>
						<div class="container">
							<div id="toolbarxs">
								<button id="btncalxs" class="btn btn-sm btn-primary">
									<i class="glyphicon glyphicon-send"></i> 计算
								</button>
								
								<button id="btnaddxs" class="btn  btn-sm btn-success">
									<i class="glyphicon glyphicon-plus"></i> 添加
								</button>
								
								<button id="btndelxs" class="btn btn-sm btn-warning">
									<i class="glyphicon glyphicon-minus"></i> 删除
								</button>
								
								<button id="btnfillxs" class="btn btn-sm btn-primary">
									<i class="glyphicon glyphicon-repeat"></i> 填充
								</button>
							</div>

							<table id="tablexs" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<th data-field="fc">init1</th>
										<th data-field="sc">init2</th>
										
									</tr>
								</thead>
							</table>

						</div>
						</p>
					</div>
					
				</div>
			</div>
			
		</div>
		 
		    
            
   
</div>




    
	    
</body>
</html>

<script>
//日历初始化
$('#ww').datepicker({
    format: 'yyyy-mm-dd',
    language: "zh-CN",
    autoclose:true,
    startView: 1,
    minViewMode: 'month',
    maxViewMode:'month'
}
);



//表格初始化
var $table = $('#table');
var index=0;

var dynamicHeaderFields=[];


var listJson = [];
var pgjzr="";


//聚合数据发送到链接


function in_array(search, array) {
	for (var i in array) {
		if (array[i] == search) {
			return true;
		}
	}
	return false;
};

$(function () {
	$('#table').bootstrapTable({
		data: listJson,
		toolbar: "#toolbar",
		idField: "sc",
		pagination: true,
		showRefresh: true,
		search: true,
		clickToSelect: true,
		columns: [
					[
						{
							title: '选择',
							//field: 'idcheck',
							field : 'checked',
							checkbox: true,
							align: 'center',
							valign: 'middle',
							colspan: 1,
							rowspan: 2,
							clickToSelect:true
						},
						
						
						
						{
							title: '保有资源量',
							field: '',
							align: 'center',
							valign: 'middle',
							colspan: 3,
							rowspan: 1
						},
						
						{
							title: '可信度系数',
							field: '',
							align: 'center',
							valign: 'middle',
							colspan: 3,
							rowspan: 1
						},
						
						
						{
							title: '设计损失量',
							field: '',
							align: 'center',
							valign: 'middle',
							colspan: 1,
							rowspan: 1
						},
						
						{
							title: '非永久矿柱',
							field: '',
							align: 'center',
							valign: 'middle',
							colspan: 2,
							rowspan: 1
						},
						
						{
							title: '采矿回采率',
							field: '',
							align: 'center',
							valign: 'middle',
							colspan: 2,
							rowspan: 1
						},
						
						{
							title: '储量备用系数',
							field: 'clbyxs',
							align: 'center',
							valign: 'middle',
							colspan: 1,
							rowspan: 2,
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
					],
					
					[
						{
							field: "b11332",
							title: "1...332",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "b333",
							title: "333",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "b2334",
							title: "2...334",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						
						{
							field: "b11332xs",
							title: "1...332",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "b333xs",
							title: "333",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "b2334xs",
							title: "2...334",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "yjkz",
							title: "永久矿柱",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "lskz",
							title: "临时矿柱",
							align: "center",
							//order: "asc",
							sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "sxyk",
							title: "三下压矿",
							align: "center",
							//order: "asc",
							sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "cqhcl",
							title: "采区回采率",
							align: "center",
							//order: "asc",
							//sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						},
						
						{
							field: "fjykzhcl",
							title: "非永久矿柱回采率",
							align: "center",
							//order: "asc",
							sortable: "true",
							editable: {
								type: 'text',
								mode: 'inline',
								validate: function (v) {
									if (!v)
										return '不能为空';

								}
							}
						}
						
						
					
					
					
					
					]
					
					
		]

	});
},


$("#btnadd").click(
	function()
			{
				row=chuliangmeirow(index);
				$table.bootstrapTable('insertRow', {index: index++, row: row})
			}
),

$("#btndel").click(
	function()
			{
				var rows= $table.bootstrapTable('getSelections');
				var rowsid=[]
				for(i=0;i<rows.length;i++)
					rowsid.push(rows[i].id);
				$table.bootstrapTable('remove', {field: 'id', values: rowsid})
			}
),

$("#btncal").click(
	function()
			{
				//获取前五年产量
				var scgm = [];
				for (var i=1; i <= 5; i++){
					
					var rewardId = $('#scgm'+i).val();
					
					if(( rewardId != "" && undefined != rewardId) )
					{
						scgm.push(eval(rewardId));
					}
					else
					{
						alert("五年生产规模请填写完整！")
						return;
					}
				}
				
				//获取类型
				type=eval($('#typeselect').selectpicker('val'));
				
				
			
				
			
				var allTableData = $table.bootstrapTable('getData');
				
				

				result1=chuliangmeitable(allTableData);
				
				
				a=JSON.stringify(scgm);
				b=JSON.stringify(result1[0]);
				
					
				$.getJSON('http://127.0.0.1:5000/mrm/api/mchuliang/', 
					
					{TYPE:type,SCGM:JSON.stringify(scgm),BYCL:JSON.stringify(result1[0]),KXDXS :JSON.stringify(result1[1]),SSSJ :JSON.stringify(result1[2]),CBXS :JSON.stringify(result1[3])},
					function(data) {
					if(data.result!="-1")
					{
						alert('评估年限：'+data.result);
						if(eval(data.result)>30)
						
						
						pgjzr=$('#ww').val();
						//alert(tempw);
						
						
						dynamicHeader=autoaddcolumns(['2016-1','2016-2']);
						dynamicHeaderFields=dynamicHeader[1];
						//初始化下一个表格
						$('#tablexs').bootstrapTable('destroy').bootstrapTable(
						{
							data: listJson,
							toolbar: "#toolbarxs",
							idField: "sc",
							pagination: true,
							showRefresh: true,
							search: true,
							clickToSelect: true,
							columns:dynamicHeader 
						});

						
						
						
						
						
						
					}
					else
					{
						alert('参数错误！');
					}
					
				  });
				  
				  
				 // return false;
				
			}
),




//销售控制

$("#btnaddxs").click(function()
	{
		row=xiaoshourow(index,dynamicHeaderFields);
		$('#tablexs').bootstrapTable('insertRow', {index: index++, row: row})

	}
),

$("#btndelxs").click(function()
	{
		var rows= $('#tablexs').bootstrapTable('getSelections');
		var rowsid=[]
		for(i=0;i<rows.length;i++)
			rowsid.push(rows[i].id);
		$('#tablexs').bootstrapTable('remove', {field: 'id', values: rowsid})

	}
),

$("#btncalxs").click(function()
	{

	}
),
  



);











</script>

  </body>
</html>